<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>Omaha Pi pypeline</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <meta name="viewport" content="width=device-width,initial-scale=1">
</head>
<body>
    <div class="container">
        <h1>Omaha Pi pypeline</h1>
        <form method="post">
            <table class="form-table">
                <tr>
                    <td><label for="vin">VIN Number:</label></td>
                    <td><input type="text" id="vin" name="vin" placeholder="Enter VIN (optional)"></td>
                </tr>
                <tr>
                    <td><label for="keywords">Keywords / Plate / Address:</label></td>
                    <td><input type="text" id="keywords" name="keywords" placeholder="e.g. Honda Civic, stolen car, ABC123"></td>
                </tr>
            </table>
            <div style="text-align:center;">
                <button type="submit">Run Search</button>
            </div>
        </form>
        {% if results %}
        <div class="results-section">
            <h2>Results</h2>
            {% for name, data in results.items() %}
                <h3>{{ name.replace('_', ' ').title() }}</h3>
                {% if data %}
                    {% if data[0] is mapping or data[0] is sequence %}
                    <div class="table-scroll">   
                        <table class="results-table">
                            <thead>
                                <tr>
                                    {% for key in data[0].keys() %}
                                    <th>{{ key }}</th>
                                    {% endfor %}
                                </tr>
                            </thead>
                            <tbody>
                                {% for row in data %}
                                <tr>
                                    {% for value in row.values() %}
                                    <!-- Prevent newlines, vertical text, and collapse all whitespace to single spaces -->
                                    <td>{{ value|string|replace('\n', ' ')|replace('\r', ' ')|replace('\t', ' ') }}</td>
                                    {% endfor %}
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                        <pre>{{ data }}</pre>
                    {% endif %}
                {% else %}
                    <em>No results found for {{ name }}.</em>
                {% endif %}
            {% endfor %}
        </div>
        {% endif %}
    </div>
</body>
</html>
